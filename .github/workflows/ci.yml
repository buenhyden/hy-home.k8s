name: CI

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    lint-markdown:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - name: Lint Markdown
              uses: DavidAnson/markdownlint-cli2-action@v22
              with:
                  globs: "**/*.md"

    lint-actions:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - name: Lint GitHub Actions
              uses: reviewdog/action-actionlint@v1
            - name: Check workflow files
              run: |
                  echo "::add-matcher::.github/actionlint-matcher.json"
                  bash <(curl https://raw.githubusercontent.com/rhysd/actionlint/main/scripts/download-actionlint.bash)
                  ./actionlint -color
              shell: bash

    validate-k8s:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - name: Validate Kubernetes Manifests
              uses: stackrox/kube-linter-action@v1
              with:
                  directory: .
                  config: .kube-linter.yaml # We'll create a default one or it will use defaults
              continue-on-error: true # Manifests might be templates, so avoid hard failure initially
