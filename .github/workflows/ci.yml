name: CI

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    lint-markdown:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - name: Lint Markdown
              uses: DavidAnson/markdownlint-cli2-action@v22
              with:
                  globs: "**/*.md"

    lint-actions:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - name: Lint GitHub Actions
              uses: reviewdog/action-actionlint@v1
            - name: Download actionlint
              id: get_actionlint
              run:
                  bash <(curl
                  https://raw.githubusercontent.com/rhysd/actionlint/main/scripts/download-actionlint.bash)
              shell: bash
            - name: Check workflow files
              run: ${{ steps.get_actionlint.outputs.executable }} -color
              shell: bash

    lint-python:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - uses: actions/setup-python@v5
              with:
                  python-version: "3.13"
            - name: Install linters
              run: python -m pip install ruff mypy
            - name: Ruff
              working-directory: apps/_examples/demo-backend/app
              run: ruff check .
            - name: Mypy
              working-directory: apps/_examples/demo-backend/app
              run: mypy .

    validate-k8s:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v6
            - name: Validate Kubernetes Manifests
              uses: stackrox/kube-linter-action@v1
              with:
                  directory: .
                  config: .kube-linter.yaml # We'll create a default one or it will use defaults
